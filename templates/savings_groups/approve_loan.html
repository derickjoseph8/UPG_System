{% extends 'base.html' %}

{% block title %}{{ page_title }} - UPG Management System{% endblock %}

{% block content %}
<div class="container-fluid">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'savings_groups:savings_list' %}">Savings Groups</a></li>
            <li class="breadcrumb-item"><a href="{% url 'savings_groups:savings_group_detail' savings_group.pk %}">{{ savings_group.name }}</a></li>
            <li class="breadcrumb-item"><a href="{% url 'savings_groups:loan_list' savings_group.pk %}">Loans</a></li>
            <li class="breadcrumb-item active">Approve Loan</li>
        </ol>
    </nav>

    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-check-circle"></i> Approve/Reject Loan Application</h5>
                </div>
                <div class="card-body">
                    <!-- Loan Summary -->
                    <div class="alert alert-info">
                        <h6 class="mb-3">Loan Application Summary</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <p class="mb-1"><strong>Member:</strong> {{ loan.member.household }}</p>
                                <p class="mb-1"><strong>Loan Amount:</strong> KES {{ loan.loan_amount|floatformat:2 }}</p>
                                <p class="mb-1"><strong>Interest Rate:</strong> {{ loan.interest_rate }}%</p>
                                <p class="mb-1"><strong>Total Due:</strong> KES {{ loan.total_due|floatformat:2 }}</p>
                            </div>
                            <div class="col-md-6">
                                <p class="mb-1"><strong>Loan Date:</strong> {{ loan.loan_date|date:"M d, Y" }}</p>
                                <p class="mb-1"><strong>Due Date:</strong> {{ loan.due_date|date:"M d, Y" }}</p>
                                <p class="mb-1"><strong>Member's Savings:</strong> KES {{ loan.member.total_savings|floatformat:2 }}</p>
                                <p class="mb-1"><strong>Group's Total Savings:</strong> KES {{ savings_group.savings_to_date|floatformat:2 }}</p>
                            </div>
                        </div>
                        {% if loan.purpose %}
                        <hr>
                        <p class="mb-0"><strong>Purpose:</strong> {{ loan.purpose }}</p>
                        {% endif %}
                    </div>

                    <!-- Approval Form -->
                    <form method="post">
                        {% csrf_token %}

                        <div class="mb-3">
                            <label for="notes" class="form-label">Notes (optional)</label>
                            <textarea class="form-control" id="notes" name="notes" rows="3" placeholder="Add any notes about this decision..."></textarea>
                        </div>

                        <div class="d-flex gap-2">
                            <button type="submit" name="action" value="approve" class="btn btn-success btn-lg">
                                <i class="fas fa-check"></i> Approve & Disburse
                            </button>
                            <button type="submit" name="action" value="reject" class="btn btn-danger btn-lg">
                                <i class="fas fa-times"></i> Reject
                            </button>
                            <a href="{% url 'savings_groups:loan_list' savings_group.pk %}" class="btn btn-secondary btn-lg">
                                <i class="fas fa-arrow-left"></i> Cancel
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
