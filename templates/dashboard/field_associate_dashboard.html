{% extends 'base.html' %}

{% block title %}Field Associate Dashboard - UPG Management System{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="fas fa-user-tie"></i> Field Associate Dashboard</h1>
    <div class="text-muted">
        Welcome, {{ user.get_full_name|default:user.username }} ({{ user.get_role_display }})
    </div>
</div>

<!-- Field Associate Statistics Cards -->
<div class="row">
    <div class="col-md-3">
        <div class="stat-card stat-card-blue">
            <div class="d-flex justify-content-between">
                <div>
                    <h3>{{ stats.managed_mentors|default:0 }}</h3>
                    <p class="mb-0">Supervised Mentors</p>
                </div>
                <div class="align-self-center">
                    <i class="fas fa-users fa-2x"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="stat-card stat-card-green">
            <div class="d-flex justify-content-between">
                <div>
                    <h3>{{ stats.total_households|default:0 }}</h3>
                    <p class="mb-0">Total Households</p>
                </div>
                <div class="align-self-center">
                    <i class="fas fa-home fa-2x"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="stat-card stat-card-orange">
            <div class="d-flex justify-content-between">
                <div>
                    <h3>{{ stats.total_villages|default:0 }}</h3>
                    <p class="mb-0">Total Villages</p>
                </div>
                <div class="align-self-center">
                    <i class="fas fa-map-marker-alt fa-2x"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <a href="{% url 'dashboard:activity_logs' %}?type=visits" class="text-decoration-none">
            <div class="stat-card" style="cursor: pointer;">
                <div class="d-flex justify-content-between">
                    <div>
                        <h3>{{ stats.visits_this_month|default:0 }}</h3>
                        <p class="mb-0">Visits This Month</p>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-walking fa-2x"></i>
                    </div>
                </div>
            </div>
        </a>
    </div>
</div>

<!-- Calls This Month Card -->
<div class="row mt-3">
    <div class="col-md-3">
        <a href="{% url 'dashboard:activity_logs' %}?type=calls" class="text-decoration-none">
            <div class="stat-card stat-card-purple" style="cursor: pointer;">
                <div class="d-flex justify-content-between">
                    <div>
                        <h3>{{ stats.calls_this_month|default:0 }}</h3>
                        <p class="mb-0">Calls This Month</p>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-phone fa-2x"></i>
                    </div>
                </div>
            </div>
        </a>
    </div>
    <div class="col-md-3">
        <a href="{% url 'dashboard:activity_logs' %}" class="text-decoration-none">
            <div class="stat-card stat-card-teal" style="cursor: pointer;">
                <div class="d-flex justify-content-between">
                    <div>
                        <h3>{{ stats.visits_this_month|default:0|add:stats.calls_this_month|default:0 }}</h3>
                        <p class="mb-0">Total Activities</p>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-tasks fa-2x"></i>
                    </div>
                </div>
            </div>
        </a>
    </div>
</div>

<!-- Quick Actions for Field Associates -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-bolt"></i> Field Associate Actions</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-2">
                        <a href="{% url 'training:training_list' %}" class="btn btn-outline-primary w-100">
                            <i class="fas fa-chalkboard-teacher"></i> Manage Trainings
                        </a>
                    </div>

                    <div class="col-md-3 mb-2">
                        <a href="{% url 'training:mentoring_dashboard' %}" class="btn btn-outline-success w-100">
                            <i class="fas fa-handshake"></i> Mentor Oversight
                        </a>
                    </div>

                    <div class="col-md-3 mb-2">
                        <a href="{% url 'households:household_list' %}" class="btn btn-outline-info w-100">
                            <i class="fas fa-home"></i> Household Management
                        </a>
                    </div>

                    <div class="col-md-3 mb-2">
                        <a href="{% url 'reports:report_list' %}" class="btn btn-outline-warning w-100">
                            <i class="fas fa-chart-bar"></i> Field Reports
                        </a>
                    </div>

                    <div class="col-md-3 mb-2">
                        <a href="{% url 'households:graduation_dashboard' %}" class="btn btn-outline-danger w-100">
                            <i class="fas fa-graduation-cap"></i> Graduation Tracking
                        </a>
                    </div>

                    <div class="col-md-3 mb-2">
                        <a href="{% url 'business_groups:group_list' %}" class="btn btn-outline-secondary w-100">
                            <i class="fas fa-users"></i> Business Groups
                        </a>
                    </div>

                    <div class="col-md-3 mb-2">
                        <a href="{% url 'surveys:survey_list' %}" class="btn btn-outline-dark w-100">
                            <i class="fas fa-clipboard-list"></i> Field Surveys
                        </a>
                    </div>

                    <div class="col-md-3 mb-2">
                        <a href="{% url 'training:mentoring_analytics' %}" class="btn btn-outline-info w-100">
                            <i class="fas fa-chart-line"></i> Performance Analytics
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Field Associate Specific Sections -->
<div class="row mt-4">
    <!-- Training Management Overview -->
    <div class="col-md-6 col-lg-3">
        <div class="card border-primary">
            <div class="card-header bg-primary text-white">
                <h6><i class="fas fa-chalkboard-teacher"></i> Training Management</h6>
            </div>
            <div class="card-body">
                <p><strong>Total Training Sessions:</strong><br>{{ stats.total_trainings|default:0 }}</p>
                <p><strong>Active Sessions:</strong><br>{{ stats.active_trainings|default:0 }}</p>
                <p><strong>Households Enrolled:</strong><br>{{ stats.households_in_training|default:0 }}</p>
                <p class="mb-0"><strong>Phone Calls:</strong><br>{{ stats.calls_this_month|default:0 }}</p>
            </div>
        </div>
    </div>

    <!-- Mentor Supervision -->
    <div class="col-md-6 col-lg-3">
        <div class="card border-success">
            <div class="card-header bg-success text-white">
                <h6><i class="fas fa-user-friends"></i> Mentor Supervision</h6>
            </div>
            <div class="card-body">
                <p><strong>Mentors Supervised:</strong><br>{{ stats.managed_mentors|default:0 }}</p>
                <p><strong>Total Households:</strong><br>{{ stats.total_households|default:0 }}</p>
                <p><strong>Visits This Month:</strong><br>
                    <a href="{% url 'dashboard:activity_logs' %}?type=visits">{{ stats.visits_this_month|default:0 }}</a>
                </p>
                <p><strong>Calls This Month:</strong><br>
                    <a href="{% url 'dashboard:activity_logs' %}?type=calls">{{ stats.calls_this_month|default:0 }}</a>
                </p>
                <p class="mb-0"><strong>Total Time:</strong><br>{{ stats.total_hours|default:0 }}h {{ stats.total_minutes|default:0 }}m</p>
            </div>
        </div>
    </div>

    <!-- Field Operations -->
    <div class="col-md-6 col-lg-3">
        <div class="card border-warning">
            <div class="card-header bg-warning text-dark">
                <h6><i class="fas fa-map-marked-alt"></i> Field Operations</h6>
            </div>
            <div class="card-body">
                <p><strong>Villages Covered:</strong><br>{{ stats.total_villages|default:0 }} Villages</p>
                <p><strong>Field Visits This Month:</strong><br>{{ stats.visits_this_month|default:0 }} Visits</p>
                <p><strong>Phone Calls This Month:</strong><br>{{ stats.calls_this_month|default:0 }} Calls</p>
                <p class="mb-0"><strong>Total Activity:</strong><br>{% widthratio stats.visits_this_month|default:0 1 1 %}+{% widthratio stats.calls_this_month|default:0 1 1 %}</p>
            </div>
        </div>
    </div>

    <!-- Data Quality -->
    <div class="col-md-6 col-lg-3">
        <div class="card border-info">
            <div class="card-header bg-info text-white">
                <h6><i class="fas fa-check-circle"></i> Data Quality</h6>
            </div>
            <div class="card-body">
                {% if data_quality %}
                <p><strong>Quality Score:</strong><br><span class="badge bg-{% if data_quality.quality_score >= 80 %}success{% elif data_quality.quality_score >= 60 %}warning{% else %}danger{% endif %} fs-6">{{ data_quality.quality_score }}%</span></p>
                <p><strong>Total Records:</strong><br>{{ data_quality.total_records|default:0 }}</p>
                <p><strong>Issues Found:</strong><br>{{ data_quality.issues_count|default:0 }}</p>
                <p class="mb-0"><strong>High Priority:</strong><br>{{ data_quality.summary.high_severity|default:0 }}</p>
                {% else %}
                <p class="text-muted">No data available</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Mentor Performance Table -->
{% if mentor_performance %}
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="fas fa-chart-bar"></i> Mentor Performance (This Month)</h5>
                <a href="{% url 'dashboard:activity_logs' %}" class="btn btn-sm btn-outline-primary">
                    <i class="fas fa-list"></i> View All Activity Logs
                </a>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Mentor</th>
                                <th>Villages</th>
                                <th>Households</th>
                                <th>Visits</th>
                                <th>Calls</th>
                                <th>Total Activity</th>
                                <th>Total Time</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for mentor in mentor_performance %}
                            <tr>
                                <td>{{ mentor.name }}</td>
                                <td>{{ mentor.villages }}</td>
                                <td>{{ mentor.households }}</td>
                                <td>
                                    <a href="{% url 'dashboard:activity_logs' %}?mentor={{ mentor.mentor.id }}&type=visits" class="text-decoration-none">
                                        <span class="badge bg-success">{{ mentor.visits_30d }}</span>
                                    </a>
                                </td>
                                <td>
                                    <a href="{% url 'dashboard:activity_logs' %}?mentor={{ mentor.mentor.id }}&type=calls" class="text-decoration-none">
                                        <span class="badge bg-info">{{ mentor.calls_30d }}</span>
                                    </a>
                                </td>
                                <td>
                                    <a href="{% url 'dashboard:activity_logs' %}?mentor={{ mentor.mentor.id }}" class="text-decoration-none">
                                        <strong>{{ mentor.total_activity }}</strong>
                                    </a>
                                </td>
                                <td>
                                    <span class="text-muted">{{ mentor.total_duration }} min</span>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="7" class="text-muted text-center">No mentors supervised</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                        <tfoot class="table-secondary">
                            <tr>
                                <th colspan="3">Total</th>
                                <th>{{ stats.visits_this_month }}</th>
                                <th>{{ stats.calls_this_month }}</th>
                                <th>{{ stats.visits_this_month|add:stats.calls_this_month }}</th>
                                <th>{{ stats.total_hours }}h {{ stats.total_minutes }}m</th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Field Associate Workflow -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-tasks"></i> Field Associate Responsibilities</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-md">
                        <div class="bg-primary text-white rounded p-3 mb-2">
                            <i class="fas fa-user-friends fa-2x mb-2"></i>
                            <h6>1. Mentor Supervision</h6>
                            <small>Oversee and support mentors</small>
                        </div>
                    </div>
                    <div class="col-md-1 d-flex align-items-center justify-content-center">
                        <i class="fas fa-arrow-right text-primary fa-2x"></i>
                    </div>
                    <div class="col-md">
                        <div class="bg-success text-white rounded p-3 mb-2">
                            <i class="fas fa-chalkboard-teacher fa-2x mb-2"></i>
                            <h6>2. Training Coordination</h6>
                            <small>Organize training sessions</small>
                        </div>
                    </div>
                    <div class="col-md-1 d-flex align-items-center justify-content-center">
                        <i class="fas fa-arrow-right text-success fa-2x"></i>
                    </div>
                    <div class="col-md">
                        <div class="bg-warning text-dark rounded p-3 mb-2">
                            <i class="fas fa-clipboard-check fa-2x mb-2"></i>
                            <h6>3. Quality Assurance</h6>
                            <small>Monitor program quality</small>
                        </div>
                    </div>
                    <div class="col-md-1 d-flex align-items-center justify-content-center">
                        <i class="fas fa-arrow-right text-warning fa-2x"></i>
                    </div>
                    <div class="col-md">
                        <div class="bg-info text-white rounded p-3 mb-2">
                            <i class="fas fa-file-alt fa-2x mb-2"></i>
                            <h6>4. Reporting</h6>
                            <small>Generate field reports</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}