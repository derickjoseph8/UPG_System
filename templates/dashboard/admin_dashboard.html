{% extends 'base.html' %}

{% block title %}System Administrator Dashboard - UPG Management System{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="fas fa-cogs"></i> System Administrator Dashboard</h1>
    <span class="badge bg-danger fs-6">Super Admin Access</span>
</div>

<!-- Alert Banners (Borrowed from UPG Kaduna MIS) -->
{% for alert in alerts %}
    {% include 'includes/alert_banner.html' with count=alert.count title=alert.title description=alert.description severity=alert.severity icon=alert.icon action_url=alert.action_url action_text=alert.action_text %}
{% endfor %}

<!-- KPI Cards with Targets (NEW - Borrowed from UPG Kaduna MIS) -->
<div class="row mb-4">
    {% for key, kpi in kpis.items %}
    <div class="col-md-3 mb-3">
        {% include 'includes/kpi_card.html' with title=kpi.title value=kpi.value target=kpi.target icon=kpi.icon icon_bg=kpi.icon_bg icon_color=kpi.icon_color %}
    </div>
    {% endfor %}
</div>

<!-- Charts Row (NEW - Borrowed from UPG Kaduna MIS) -->
<div class="row mb-4">
    <!-- Enrollment Trend Chart -->
    <div class="col-md-8">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-white">
                <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Enrollment Trend (Last 6 Months)</h5>
            </div>
            <div class="card-body">
                {% include 'includes/charts/line_chart.html' with chart_id='enrollmentTrendChart' labels=enrollment_trend.labels values=enrollment_trend.values dataset_label='Cumulative Households' height=280 %}
            </div>
        </div>
    </div>

    <!-- Status Distribution Chart -->
    <div class="col-md-4">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-white">
                <h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i>Participation Status</h5>
            </div>
            <div class="card-body">
                {% include 'includes/charts/doughnut_chart.html' with chart_id='statusDistChart' labels=status_distribution.labels values=status_distribution.values bg_colors=status_distribution.colors height=250 %}
            </div>
        </div>
    </div>
</div>

<!-- Geographic Distribution & Grants Row -->
<div class="row mb-4">
    <!-- Geographic Distribution -->
    <div class="col-md-6">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-white">
                <h5 class="mb-0"><i class="fas fa-map-marked-alt me-2"></i>Households by SubCounty</h5>
            </div>
            <div class="card-body">
                {% include 'includes/charts/bar_chart.html' with chart_id='geoDistChart' labels=geographic_distribution.labels values=geographic_distribution.values dataset_label='Households' index_axis='y' height=250 %}
            </div>
        </div>
    </div>

    <!-- Grant Distribution -->
    <div class="col-md-6">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-white">
                <h5 class="mb-0"><i class="fas fa-hand-holding-usd me-2"></i>Grants Disbursed by Type</h5>
            </div>
            <div class="card-body">
                {% include 'includes/charts/bar_chart.html' with chart_id='grantDistChart' labels=grant_distribution.labels values=grant_distribution.values bg_colors=grant_distribution.colors dataset_label='Count' height=250 %}
            </div>
        </div>
    </div>
</div>

<!-- Data Quality & Program Overview Row -->
<div class="row mb-4">
    <!-- Data Quality Widget (NEW - Borrowed from UPG Kaduna MIS) -->
    <div class="col-md-6">
        {% include 'includes/data_quality_widget.html' with quality=data_quality %}
    </div>

    <!-- Financial Metrics Card -->
    <div class="col-md-6">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-white">
                <h5 class="mb-0"><i class="fas fa-money-bill-wave me-2"></i>Financial Metrics</h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-6">
                        <div class="border rounded p-3 text-center">
                            <h4 class="text-primary mb-1">KES {{ financial_metrics.grants_disbursed|floatformat:0|default:0 }}</h4>
                            <small class="text-muted">Total Disbursed</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="border rounded p-3 text-center">
                            <h4 class="text-success mb-1">{{ stats.total_grants_funded }}</h4>
                            <small class="text-muted">Grants Funded</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="border rounded p-3 text-center">
                            <h4 class="text-info mb-1">{{ stats.sb_grants_funded }}</h4>
                            <small class="text-muted">SB Grants</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="border rounded p-3 text-center">
                            <h4 class="text-warning mb-1">{{ stats.pr_grants_funded }}</h4>
                            <small class="text-muted">PR Grants</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- System Administration Quick Links -->
<div class="row mb-4">
    <div class="col-md-12">
        <div class="card shadow-sm">
            <div class="card-header bg-white">
                <h5 class="mb-0"><i class="fas fa-tools me-2"></i>System Administration</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <a href="{% url 'settings:settings_dashboard' %}" class="btn btn-outline-primary w-100 py-3">
                            <i class="fas fa-users-cog fa-2x mb-2 d-block"></i>
                            User Management
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="{% url 'core:esr_import_list' %}" class="btn btn-outline-success w-100 py-3">
                            <i class="fas fa-file-import fa-2x mb-2 d-block"></i>
                            ESR Import
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="{% url 'programs:program_list' %}" class="btn btn-outline-info w-100 py-3">
                            <i class="fas fa-project-diagram fa-2x mb-2 d-block"></i>
                            Program Management
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="{% url 'reports:report_list' %}" class="btn btn-outline-warning w-100 py-3">
                            <i class="fas fa-chart-bar fa-2x mb-2 d-block"></i>
                            System Reports
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Training & Mentoring Progress Row -->
<div class="row mb-4">
    <div class="col-md-6">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-white">
                <h5 class="mb-0"><i class="fas fa-graduation-cap me-2"></i>Training Progress</h5>
            </div>
            <div class="card-body">
                {% include 'includes/progress_indicator.html' with label='Modules Completed' current=training_progress.modules_completed target=12 %}
                {% include 'includes/progress_indicator.html' with label='Mentoring Sessions' current=training_progress.mentoring_sessions target=200 %}

                <div class="row mt-3">
                    <div class="col-6">
                        <div class="text-center p-2 bg-light rounded">
                            <div class="fw-bold text-success">{{ training_progress.attendance_rates }}</div>
                            <small class="text-muted">Attendance Rate</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="text-center p-2 bg-light rounded">
                            <div class="fw-bold text-primary">{{ training_progress.skill_development }}</div>
                            <small class="text-muted">Skill Development</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-white">
                <h5 class="mb-0"><i class="fas fa-clipboard-list me-2"></i>Mentor Activity (This Month)</h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-6">
                        <a href="{% url 'dashboard:activity_logs' %}?type=visits" class="text-decoration-none">
                            <div class="border rounded p-3 text-center bg-success bg-opacity-10" style="cursor: pointer;">
                                <h3 class="text-success mb-1">{{ stats.visits_this_month }}</h3>
                                <small class="text-muted">Home Visits</small>
                            </div>
                        </a>
                    </div>
                    <div class="col-6">
                        <a href="{% url 'dashboard:activity_logs' %}?type=calls" class="text-decoration-none">
                            <div class="border rounded p-3 text-center bg-info bg-opacity-10" style="cursor: pointer;">
                                <h3 class="text-info mb-1">{{ stats.calls_this_month }}</h3>
                                <small class="text-muted">Phone Nudges</small>
                            </div>
                        </a>
                    </div>
                    <div class="col-6">
                        <div class="border rounded p-3 text-center">
                            <h3 class="text-primary mb-1">{{ stats.total_house_visits }}</h3>
                            <small class="text-muted">Total Visits</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="border rounded p-3 text-center">
                            <h3 class="text-secondary mb-1">{{ stats.total_phone_calls }}</h3>
                            <small class="text-muted">Total Calls</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Geographic Coverage & System Status -->
<div class="row">
    <div class="col-md-6">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-white">
                <h5 class="mb-0"><i class="fas fa-globe-africa me-2"></i>Geographic Coverage</h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-6">
                        <div class="text-center p-3 bg-primary bg-opacity-10 rounded">
                            <h4 class="text-primary mb-1">{{ geographic_coverage.villages_by_county }}</h4>
                            <small class="text-muted">SubCounties</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="text-center p-3 bg-success bg-opacity-10 rounded">
                            <h4 class="text-success mb-1">{{ geographic_coverage.household_distribution }}</h4>
                            <small class="text-muted">Households</small>
                        </div>
                    </div>
                </div>
                <div class="mt-3 p-2 bg-light rounded">
                    <small class="text-muted">
                        <i class="fas fa-map-marker-alt text-danger me-1"></i>
                        <strong>Focus Area:</strong> {{ geographic_coverage.mentor_coverage_map }}
                    </small>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-white">
                <h5 class="mb-0"><i class="fas fa-server me-2"></i>System Status</h5>
            </div>
            <div class="card-body">
                <ul class="list-group list-group-flush">
                    <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                        <span><i class="fas fa-check-circle text-success me-2"></i>All services operational</span>
                        <span class="badge bg-success">Online</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                        <span><i class="fas fa-database text-info me-2"></i>Database health</span>
                        <span class="badge bg-success">Good</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                        <span><i class="fas fa-sync-alt text-primary me-2"></i>Last backup</span>
                        <span class="badge bg-secondary">Today</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                        <span><i class="fas fa-clock text-warning me-2"></i>Uptime</span>
                        <span class="badge bg-success">99.9%</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

{% endblock %}
